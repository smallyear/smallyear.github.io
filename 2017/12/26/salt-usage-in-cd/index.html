<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="综述现在的cd环境中使用salt部署组件时使用了salt的state模块，在部署前先生成组件的sls文件，然后通过salt插件或者salt-ssh插件来完成部署 salt插件和salt-ssh使用的sls文件一样，只是执行命令有些许的差别 salt适用于安装minion的node salt-ssh适用于无法安装minion的node，但需支持ssh协议 salt命令格式如下 12345678910">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2017/12/26/salt-usage-in-cd/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="综述现在的cd环境中使用salt部署组件时使用了salt的state模块，在部署前先生成组件的sls文件，然后通过salt插件或者salt-ssh插件来完成部署 salt插件和salt-ssh使用的sls文件一样，只是执行命令有些许的差别 salt适用于安装minion的node salt-ssh适用于无法安装minion的node，但需支持ssh协议 salt命令格式如下 12345678910">
<meta property="og:updated_time" content="2017-12-19T01:47:57.812Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="综述现在的cd环境中使用salt部署组件时使用了salt的state模块，在部署前先生成组件的sls文件，然后通过salt插件或者salt-ssh插件来完成部署 salt插件和salt-ssh使用的sls文件一样，只是执行命令有些许的差别 salt适用于安装minion的node salt-ssh适用于无法安装minion的node，但需支持ssh协议 salt命令格式如下 12345678910">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-salt-usage-in-cd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/26/salt-usage-in-cd/" class="article-date">
  <time datetime="2017-12-26T08:42:59.246Z" itemprop="datePublished">2017-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h4><p>现在的cd环境中使用salt部署组件时使用了salt的state模块，在部署前先生成组件的sls文件，然后通过salt插件或者salt-ssh插件来完成部署</p>
<p>salt插件和salt-ssh使用的sls文件一样，只是执行命令有些许的差别</p>
<p>salt适用于安装minion的node</p>
<p>salt-ssh适用于无法安装minion的node，但需支持ssh协议</p>
<p>salt命令格式如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">举例：</span><br><span class="line"></span><br><span class="line">sudo salt -S 10.126.3.248 state.sls 36bc800e-220a-4a84-a864-cf3b067f7d51.current.deps_linux7_install</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line">sudo 											-- sudo</span><br><span class="line">salt 		       								-- salt命令</span><br><span class="line">-S     			 								-- 定位minion的方式,-S为通过ip定位</span><br><span class="line">10.126.3.248									-- 指定node的ip</span><br><span class="line">state.sls 						        		-- salt的state模块</span><br><span class="line">36bc800e-220a-4a84-a864-cf3b067f7d51.current 	-- salt工件包相对于/srv/salt的路径</span><br><span class="line">deps_linux7_install 							-- 具体执行的文件名</span><br></pre></td></tr></table></figure>
<p>salt-ssh的命令格式如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">举例：</span><br><span class="line"></span><br><span class="line">sudo salt-ssh -i 10.126.3.248 state.sls 36bc800e-220a-4a84-a864-cf3b067f7d51.current.deps_linux7_install</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line"></span><br><span class="line">sudo 											-- sudo</span><br><span class="line">salt命令 		       							-- salt命令</span><br><span class="line">-i     			 								-- 忽略执行salt-ssh的跟系统的交互</span><br><span class="line">10.126.3.248									-- 指定node的ip</span><br></pre></td></tr></table></figure>
<h4 id="cd中salt的安装"><a href="#cd中salt的安装" class="headerlink" title="cd中salt的安装"></a>cd中salt的安装</h4><h5 id="salt-master和salt-ssh"><a href="#salt-master和salt-ssh" class="headerlink" title="salt-master和salt-ssh"></a>salt-master和salt-ssh</h5><p>现有cd中salt-master以及salt-ssh的安装使用单独的脚本进行安装<br>脚本内容如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo "start install salt-master..."</span><br><span class="line">yum install salt-master salt-ssh -y</span><br><span class="line"></span><br><span class="line">sed -i "s/#auto_accept.*/auto_accept: True/g" /etc/salt/master</span><br><span class="line">service salt-master start</span><br><span class="line"></span><br><span class="line">echo "sync pillar data"</span><br><span class="line">mkdir -pv /srv/salt/</span><br><span class="line">cp -r pillar /srv</span><br><span class="line"></span><br><span class="line">salt '*' saltutil.refresh_pillar</span><br><span class="line"></span><br><span class="line">echo "install salt-master success..."</span><br></pre></td></tr></table></figure></p>
<p>salt-master安装时会同步现有的组件的pillar数据</p>
<h5 id="salt-minion"><a href="#salt-minion" class="headerlink" title="salt-minion"></a>salt-minion</h5><p>cd1.5中salt-minion的安装是通过蓝图流程安装<br>cd1.6中salt-minion的安装是在启动node的脚本中实现<br>首先在master的配置文件中修改以下参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#salt-master-ip</span><br><span class="line">saltMasterIp=10.126.3.203</span><br><span class="line">#repo-ip</span><br><span class="line">repoIp=10.126.3.202</span><br></pre></td></tr></table></figure></p>
<p>通过页面下载node安装包之后执行start.sh会自动安装salt-minion</p>
<h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><p>cd中跟salt有关的插件有以下五个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- DownloadSaltArtifact  -- 下载salt工件</span><br><span class="line">- DownloadSaltComp		-- 下载salt组件</span><br><span class="line">- SaltConfig			-- 修改salt组件配置</span><br><span class="line">- salt-ssh				-- 执行salt-ssh命令</span><br><span class="line">- salt 					-- 执行salt命令</span><br></pre></td></tr></table></figure></p>
<h4 id="商业中间件"><a href="#商业中间件" class="headerlink" title="商业中间件"></a>商业中间件</h4><p>四个商业中间件的salt工件包就是将中间件的静默安装流程通过salt进行了封装</p>
<p>以oracle11g为例进行讲解</p>
<h5 id="oracle工件包结构"><a href="#oracle工件包结构" class="headerlink" title="oracle工件包结构"></a>oracle工件包结构</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# tree /srv/salt/oracle</span><br><span class="line">.</span><br><span class="line">├── create_db.sls 					# 创建数据库</span><br><span class="line">├── dbbin.sls 						# 初始化oracle</span><br><span class="line">├── delete_db.sls 					# 删除数据库</span><br><span class="line">├── deps_linux7_install.sls 		# 安装数据库依赖文件</span><br><span class="line">├── destroy.sls 					# 卸载数据库</span><br><span class="line">├── files 							# 需要同步的配置文件</span><br><span class="line">│   ├── glogin.sql</span><br><span class="line">│   ├── ora_limits</span><br><span class="line">│   ├── ora_params</span><br><span class="line">│   └── unzip-6.0-1.el6.x86_64.rpm</span><br><span class="line">├── init.sls 						# 安装oracle</span><br><span class="line">├── kernel_params.sls               # 修改系统kernel参数</span><br><span class="line">├── logrotate_alert_log.sls         # 配置oracle-alert-log文件</span><br><span class="line">├── logrotate_listener.sls  		# 配置oracle-listener文件</span><br><span class="line">├── lsnrctl.sls 					# 配置监听</span><br><span class="line">├── oracle11g.ftl 					# oracle11g组件的pillar模版</span><br><span class="line">├── oracle11g.sls 					# oracle11g组件的pillar文件</span><br><span class="line">├── oracle_user_config.sls  		# 用户配置</span><br><span class="line">├── setting.sls 					# setting配置</span><br><span class="line">├── templates 						# 配置模版文件</span><br><span class="line">│   ├── db11R23.rsp</span><br><span class="line">│   ├── dbca.rsp</span><br><span class="line">│   ├── listener.ora</span><br><span class="line">│   ├── oracle-alert-log</span><br><span class="line">│   ├── oracle-listener</span><br><span class="line">│   ├── ora_init_script</span><br><span class="line">│   ├── ora_profile</span><br><span class="line">│   ├── ora_profile_append</span><br><span class="line">│   └── tnsnames.ora</span><br><span class="line">├── templates.properties 			# 模版映射文件</span><br><span class="line">└── test.sls 						# 测试文件</span><br></pre></td></tr></table></figure>
<h6 id="setting-sls"><a href="#setting-sls" class="headerlink" title="setting.sls"></a>setting.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat setting.sls </span><br><span class="line">#获取pillar数据 赋值给p</span><br><span class="line">&#123;% set p  = salt[&apos;pillar.get&apos;](&apos;oracinstall&apos;, &#123;&#125;) %&#125;</span><br><span class="line">#获取grains数据 赋值给g</span><br><span class="line">&#123;% set g  = salt[&apos;grains.get&apos;](&apos;oracinstall&apos;, &#123;&#125;) %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#以下内容均为获取pillar或者grains中的变量 然后赋值给变量</span><br><span class="line">&#123;%- set orac_fqdn  = salt[&apos;grains.get&apos;](&apos;fqdn&apos;, &apos;oracle&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_install_dir  = salt[&apos;pillar.get&apos;](&apos;orac_install_dir&apos;, &apos;/opt/oracle11g/install_dir&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_inventory  = salt[&apos;pillar.get&apos;](&apos;orac_inventory&apos;, &apos;/opt/oraInventory&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_user_gid = salt[&apos;pillar.get&apos;](&apos;orac_user_gid&apos;, &apos;201&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_user = salt[&apos;pillar.get&apos;](&apos;orac_user&apos;, &apos;oracle&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_user_uid = salt[&apos;pillar.get&apos;](&apos;orac_user_uid&apos;, &apos;201&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_user_shell = salt[&apos;pillar.get&apos;](&apos;orac_user_shell&apos;, &apos;/bin/bash&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_user_sup_grps = salt[&apos;pillar.get&apos;](&apos;orac_user_sup_grps&apos;, &apos;&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_pw = salt[&apos;pillar.get&apos;](&apos;orac_pw&apos;, &apos;passw0rd&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_base = salt[&apos;pillar.get&apos;](&apos;ora_base&apos;, &apos;/opt/oracle11g&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_home = salt[&apos;pillar.get&apos;](&apos;ora_home&apos;, &apos;/opt/oracle11g/11R23&apos;)%&#125;</span><br><span class="line">&#123;%- set orac_sid = salt[&apos;pillar.get&apos;](&apos;orac_sid&apos;, &apos;ora&apos;) %&#125;</span><br><span class="line">&#123;%- set orac_dbpw = salt[&apos;pillar.get&apos;](&apos;orac_dbpw&apos;, &apos;oracle&apos;) %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;%- set file_server_url = salt[&apos;pillar.get&apos;](&apos;file_server&apos;, &apos;http://10.81.22.83&apos;) %&#125;</span><br><span class="line">&#123;%- set oracle_deps_rpm_url = file_server_url ~ &apos;/oracle11g/linux/&apos; %&#125;</span><br><span class="line">&#123;%- set oracle_deps_name = salt[&apos;pillar.get&apos;](&apos;oracle_deps_name&apos;, &apos;oracle11g_deps&apos;) %&#125;</span><br><span class="line"></span><br><span class="line">&#123;%- set oracle_sysctl = salt[&apos;pillar.get&apos;](&apos;oracle_sysctl&apos;, &apos;&apos;) %&#125;</span><br><span class="line"></span><br><span class="line">&#123;%- set install_files = salt[&apos;pillar.get&apos;](&apos;orac_install_files&apos;, &apos;&apos;) %&#125;</span><br><span class="line"></span><br><span class="line">&#123;%- set orac_env_path =  &apos;/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/usr/sbin:&apos; ~ orac_base ~ &apos;/dba/bin:/bin:&apos; ~ orac_home ~ &apos;/OPatch&apos; %&#125;</span><br><span class="line"></span><br><span class="line">#将变量复制给oracinstall，以方便其他sls文件引用</span><br><span class="line">&#123;%- set oracinstall = &#123;&#125; %&#125;</span><br><span class="line">&#123;%- do oracinstall.update( &#123; &apos;orac_fqdn&apos;: orac_fqdn,</span><br><span class="line">                        &apos;orac_user_gid&apos;: orac_user_gid,</span><br><span class="line">						&apos;orac_user&apos;: orac_user,</span><br><span class="line">						&apos;orac_user_uid&apos;: orac_user_uid,</span><br><span class="line">						&apos;orac_user_shell&apos;: orac_user_shell,</span><br><span class="line">						&apos;orac_user_sup_grps&apos;:orac_user_sup_grps,</span><br><span class="line">						&apos;orac_pw&apos;: orac_pw,</span><br><span class="line">						&apos;orac_dbpw&apos;: orac_dbpw,</span><br><span class="line">						&apos;orac_home&apos;: orac_home,						</span><br><span class="line">						&apos;orac_base&apos;: orac_base,</span><br><span class="line">						&apos;orac_sid&apos;: orac_sid,	</span><br><span class="line">						&apos;oracle_deps_rpm_url&apos;: oracle_deps_rpm_url,</span><br><span class="line">						&apos;oracle_deps_name&apos;: oracle_deps_name,	</span><br><span class="line">                        &apos;orac_env_path&apos;: orac_env_path, </span><br><span class="line">                        &apos;file_server_url&apos;: file_server_url, 		</span><br><span class="line">                        &apos;oracle_sysctl&apos;: oracle_sysctl,</span><br><span class="line">                        &apos;orac_install_dir&apos;: orac_install_dir,</span><br><span class="line">                        &apos;orac_inventory&apos;: orac_inventory,			</span><br><span class="line">                        &apos;install_files&apos;: install_files,							</span><br><span class="line">                    &#125; ) %&#125;</span><br></pre></td></tr></table></figure>
<h6 id="init-sls"><a href="#init-sls" class="headerlink" title="init.sls"></a>init.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat init.sls </span><br><span class="line">#引用同目录下的sls文件</span><br><span class="line">include:</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.oracle_user_config</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.deps_linux7_install</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.kernel_params</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.dbbin</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.logrotate_alert_log</span><br><span class="line">  - $&#123;instanceId?if_exists&#125;.logrotate_listener</span><br></pre></td></tr></table></figure>
<h6 id="oracle-user-config-sls"><a href="#oracle-user-config-sls" class="headerlink" title="oracle_user_config.sls"></a>oracle_user_config.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat oracle_user_config.sls </span><br><span class="line">#引用同目录下的setting.sls文件，在生成每个实例的工件文件之后$&#123;instanceId?if_exists&#125;会被替换成 实例id/版本 的形式</span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line">#创建oinstall组</span><br><span class="line">create group oinstall:</span><br><span class="line">    group.present:</span><br><span class="line">        - name: oinstall</span><br><span class="line">        - gid: &#123;&#123; oracinstall.orac_user_gid &#125;&#125;</span><br><span class="line"></span><br><span class="line">#创建&#123;&#123; oracinstall.orac_user &#125;&#125;用户</span><br><span class="line">create user  &#123;&#123; oracinstall.orac_user &#125;&#125;:</span><br><span class="line">    user.present:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - uid: &#123;&#123; oracinstall.orac_user_uid &#125;&#125;</span><br><span class="line">        - gid: &#123;&#123; oracinstall.orac_user_gid &#125;&#125;</span><br><span class="line">        - shell: &#123;&#123; oracinstall.orac_user_shell &#125;&#125;</span><br><span class="line">        - comment: Oracle Administrator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Configure the oracle user.</span><br><span class="line"># Make it a member of the appropriate supplementary groups, and</span><br><span class="line"># ensure its environment will be set up properly upon login.</span><br><span class="line"></span><br><span class="line">&#123;% for grp, gid in oracinstall.orac_user_sup_grps.items() %&#125;</span><br><span class="line">create group &#123;&#123; grp &#125;&#125;:</span><br><span class="line">    group.present:</span><br><span class="line">        - name: &#123;&#123; grp &#125;&#125;</span><br><span class="line">        - gid: &#123;&#123; gid &#125;&#125;</span><br><span class="line">        - addusers:</span><br><span class="line">            - &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">#配置oracle环境变量 将ora_profile_append模版文件拼接到.bash_profile文件之后</span><br><span class="line">template &quot;/home/&#123;&#123; oracinstall.orac_user &#125;&#125;/.profile&quot;:</span><br><span class="line">    file.append:</span><br><span class="line">        - name: /home/&#123;&#123; oracinstall.orac_user &#125;&#125;/.bash_profile</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/ora_profile_append</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">            orac_base: &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">            orac_sid: &#123;&#123; oracinstall.orac_sid &#125;&#125;</span><br><span class="line">            orac_home: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line"></span><br><span class="line">#刷新配置文件</span><br><span class="line">source profile:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: source /home/&#123;&#123; oracinstall.orac_user &#125;&#125;/.bash_profile</span><br><span class="line">#设置shell环境参数</span><br><span class="line">color setup for ls:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: /usr/bin/dircolors -p &gt; /home/&#123;&#123; oracinstall.orac_user &#125;&#125;/.dir_colors</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - cwd: /home/&#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - only: [[ &#123;&#123; oracinstall.orac_user_shell &#125;&#125; != &quot;/bin/bash&quot; ]]</span><br><span class="line"></span><br><span class="line">#修改用户密码</span><br><span class="line">set the oracle user&apos;s password:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: echo &#123;&#123; oracinstall.orac_user &#125;&#125;:&#123;&#123; oracinstall.orac_pw &#125;&#125; | /usr/sbin/chpasswd</span><br><span class="line"></span><br><span class="line">#修改文件权限</span><br><span class="line">set resource limits for the oracle user:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: /etc/security/limits.d/oracle.conf</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/files/ora_limits</span><br></pre></td></tr></table></figure>
<h6 id="deps-linux7-install-sls"><a href="#deps-linux7-install-sls" class="headerlink" title="deps_linux7_install.sls"></a>deps_linux7_install.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat deps_linux7_install.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line">#根据操作系统和版本配置yum源</span><br><span class="line">&#123;% if grains[&apos;os&apos;] == &apos;Redhat&apos; %&#125;</span><br><span class="line">yumconfig_rhel:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - cwd: /etc/yum.repos.d</span><br><span class="line">        - names:</span><br><span class="line">            - rm -f *.repo;echo &apos;[rhel71]&apos; &gt; rhel71.repo;echo &apos;name=Red Hat 7.1&apos; &gt;&gt; rhel71.repo; echo &apos;baseurl=&#123;&#123; oracinstall.file_server_url &#125;&#125;/yum/redhat7&apos; &gt;&gt; rhel71.repo; echo &apos;enabled=1&apos; &gt;&gt; rhel71.repo; echo &apos;gpgcheck=0&apos; &gt;&gt; rhel71.repo</span><br><span class="line">&#123;% elif grains[&apos;os&apos;] == &apos;CentOS&apos; %&#125;</span><br><span class="line">&#123;% if grains[&apos;osmajorrelease&apos;] == 6 %&#125;</span><br><span class="line">yumconfig_rhel:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - cwd: /etc/yum.repos.d</span><br><span class="line">        - names:</span><br><span class="line">            - rm -f *.repo;echo &apos;[centos6]&apos; &gt; centos6.repo;echo &apos;name=CentOS6&apos; &gt;&gt; centos6.repo;echo &apos;baseurl=&#123;&#123; oracinstall.file_server_url &#125;&#125;/yum/centos6&apos; &gt;&gt; centos6.repo;echo &apos;enabled=1&apos; &gt;&gt; centos6.repo;echo &apos;gpgcheck=0&apos; &gt;&gt; centos6.repo</span><br><span class="line">&#123;% elif grains[&apos;osmajorrelease&apos;] == 7 %&#125;</span><br><span class="line">yumconfig_rhel:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - cwd: /etc/yum.repos.d</span><br><span class="line">        - names:</span><br><span class="line">            - rm -f *.repo;echo &apos;[centos7]&apos; &gt; centos7.repo;echo &apos;name=CentOS7 &gt;&gt; centos7.repo;echo &apos;baseurl=&#123;&#123; oracinstall.file_server_url &#125;&#125;/yum/centos7&apos; &gt;&gt; centos7.repo;echo &apos;enabled=1&apos; &gt;&gt; centos7.repo;echo &apos;gpgcheck=0&apos; &gt;&gt; centos7.repo</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">#清理和更新yum源</span><br><span class="line">yum clean:</span><br><span class="line">  cmd.run:</span><br><span class="line">    - name: yum clean all; yum makecache</span><br><span class="line"></span><br><span class="line">#安装oracle依赖包</span><br><span class="line">install dependent from ISO yum repo first:</span><br><span class="line">    pkg.installed:</span><br><span class="line">        - pkgs:</span><br><span class="line">            - binutils</span><br><span class="line">            - gcc </span><br><span class="line">            - gcc-c++ </span><br><span class="line">            - glibc </span><br><span class="line">            - glibc-devel </span><br><span class="line">            - ksh </span><br><span class="line">            - libgcc </span><br><span class="line">            - libstdc++ </span><br><span class="line">            - libstdc++-devel </span><br><span class="line">            - libaio </span><br><span class="line">            - libaio-devel </span><br><span class="line">            - libXext </span><br><span class="line">            - libXtst </span><br><span class="line">            - libX11 </span><br><span class="line">            - libXau </span><br><span class="line">            - libxcb </span><br><span class="line">            - libXi </span><br><span class="line">            - make </span><br><span class="line">            - sysstat </span><br><span class="line">            - unixODBC </span><br><span class="line">            - unixODBC-devel </span><br><span class="line">            - zlib-devel </span><br><span class="line">            - elfutils-libelf-devel </span><br><span class="line">            - unzip </span><br><span class="line">            - curl </span><br><span class="line">#创建临时文件</span><br><span class="line">mdkir_tmp_deps:</span><br><span class="line">    file.directory:</span><br><span class="line">        - name: /tmp/deps</span><br><span class="line">        - makedirs: True</span><br><span class="line">#安装依赖包</span><br><span class="line">&#123;% if grains[&apos;osmajorrelease&apos;] == &apos;6&apos; %&#125;</span><br><span class="line">install dependent that does not included in the ISO, use rpm package:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - runas: root</span><br><span class="line">        - cwd: /tmp/deps</span><br><span class="line">        - names:</span><br><span class="line">            -  curl -kO &#123;&#123; oracinstall.oracle_deps_rpm_url &#125;&#125;&#123;&#123; oracinstall.oracle_deps_name &#125;&#125;6.zip;unzip &#123;&#123; oracinstall.oracle_deps_name &#125;&#125;6.zip;rpm -ivh *.rpm --force --nodeps</span><br><span class="line">        - bg: True</span><br><span class="line">&#123;% elif grains[&apos;osmajorrelease&apos;] == &apos;7&apos; %&#125;</span><br><span class="line">install dependent that does not included in the ISO, use rpm package:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - runas: root</span><br><span class="line">        - cwd: /tmp/deps</span><br><span class="line">        - names:</span><br><span class="line">            -  curl -kO &#123;&#123; oracinstall.oracle_deps_rpm_url &#125;&#125;&#123;&#123; oracinstall.oracle_deps_name &#125;&#125;7.zip;unzip &#123;&#123; oracinstall.oracle_deps_name &#125;&#125;7.zip;rpm -ivh *.rpm --force --nodeps</span><br><span class="line">        - bg: True</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">#配置hostname</span><br><span class="line">add hostname to /etc/hosts if it has not been done:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - runas: root</span><br><span class="line">        - cwd: /</span><br><span class="line">        - name: hostn=`hostname`; hostns=`hostname -s`; cat /etc/hosts | grep -i $&#123;hostn&#125;; if [ $? -ne 0 ]; then ippdr=`ifconfig -a|grep inet|grep -v &quot;inet6&quot;|grep -v &quot;127.0.0.1&quot;|awk &apos;&#123;print $2&#125;&apos;|tr -d &quot;addr:&quot;`; echo &quot;$&#123;ippdr&#125;  $&#123;hostn&#125;  $&#123;hostns&#125;&quot; &gt;&gt;/etc/hosts; fi</span><br></pre></td></tr></table></figure>
<h6 id="kernel-params-sls"><a href="#kernel-params-sls" class="headerlink" title="kernel_params.sls"></a>kernel_params.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost oracle]# cat kernel_params.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line">#jinjia语法中的for循环</span><br><span class="line">#配置kernel_params参数</span><br><span class="line">&#123;% for sys_param_name,sys_param_value in oracinstall.oracle_sysctl.items() %&#125;</span><br><span class="line">&#123;&#123; sys_param_name &#125;&#125;:</span><br><span class="line">  sysctl:</span><br><span class="line">    - present</span><br><span class="line">    - name: &#123;&#123; sys_param_name &#125;&#125;</span><br><span class="line">    - value: &#123;&#123; sys_param_value &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">#刷新kernel_params参数</span><br><span class="line">sysctl reload:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: source /etc/init.d/functions</span><br></pre></td></tr></table></figure>
<h6 id="dbbin-sls"><a href="#dbbin-sls" class="headerlink" title="dbbin.sls"></a>dbbin.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat dbbin.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line">#创建目录</span><br><span class="line">create install dir:</span><br><span class="line">    file.directory:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0775</span><br><span class="line">        - makedirs: True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Fetching the install media with curl and unzipping them.</span><br><span class="line"># We run two resources to avoid chef-client&apos;s runaway memory usage resulting</span><br><span class="line"># in the kernel killing it.</span><br><span class="line"></span><br><span class="line">#jinjia语法中的for循环，执行cmd命令获取安装包文件</span><br><span class="line">&#123;% for zip_file in oracinstall.install_files %&#125;</span><br><span class="line">fetch_oracle_media_&#123;&#123; zip_file &#125;&#125;:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: curl -kO &#123;&#123; zip_file &#125;&#125; &gt; /dev/null</span><br><span class="line">        - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - cwd: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line">        - only: stat &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/&#123;&#123; zip_file &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">#解压</span><br><span class="line">unzip_oracle_media_zip1:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: unzip -u linux.x64_11gR2_database_1of2.zip &gt; /dev/null</span><br><span class="line">        - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - cwd: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line"></span><br><span class="line">unzip_oracle_media_zip2:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: unzip -u linux.x64_11gR2_database_2of2.zip &gt; /dev/null</span><br><span class="line">        - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - cwd: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line"></span><br><span class="line">#同步oraInst.loc文件</span><br><span class="line">create praInst.loc:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_base &#125;&#125;/oraInst.loc</span><br><span class="line">        - contents:</span><br><span class="line">            - inst_group=oinstall</span><br><span class="line">            - inventory_loc=&#123;&#123; oracinstall.orac_inventory &#125;&#125;</span><br><span class="line">        - mode: 755</span><br><span class="line"></span><br><span class="line">#创建&#123;&#123; oracinstall.orac_inventory &#125;&#125;目录</span><br><span class="line">#&#123;&#123; oracinstall.orac_inventory &#125;&#125;具体值在setting中获取</span><br><span class="line">create dir &#123;&#123; oracinstall.orac_inventory &#125;&#125;:</span><br><span class="line">    file.directory:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_inventory &#125;&#125;</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0755</span><br><span class="line">        - makedirs: True</span><br><span class="line"></span><br><span class="line">#执行cmd命令 修改&#123;&#123; oracinstall.orac_inventory &#125;&#125;所属组</span><br><span class="line">chown_oracle_inventory:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: chown -R &#123;&#123; oracinstall.orac_user &#125;&#125;:oinstall &#123;&#123; oracinstall.orac_inventory &#125;&#125;</span><br><span class="line">        - runas: root</span><br><span class="line">        - cwd: /opt</span><br><span class="line">        - only : stat &#123;&#123; oracinstall.orac_inventory &#125;&#125;/install.platform</span><br><span class="line"></span><br><span class="line">#同步oreacle应答文件</span><br><span class="line">template &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db11R23.rsp:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db11R23.rsp</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/db11R23.rsp</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">          orac_fqdn: &#123;&#123; oracinstall.orac_fqdn &#125;&#125;</span><br><span class="line">          orac_inventory: &#123;&#123; oracinstall.orac_inventory &#125;&#125;</span><br><span class="line">          orac_home: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">          orac_base: &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Running the installer. We have to run it with sudo because</span><br><span class="line"># the installer fails if the user isn&apos;t a member of the dba group,</span><br><span class="line"># and Chef itself doesn&apos;t provide a way to call setgroups(2).</span><br><span class="line"># We also ignore an exit status of 6: runInstaller fails to realise that</span><br><span class="line"># prerequisites are indeed met on CentOS 6.4.</span><br><span class="line"></span><br><span class="line">#执行安装命令</span><br><span class="line">run_rdbms_installer:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - cwd: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/database</span><br><span class="line">        # todo: returns [0, 253]</span><br><span class="line">        - name: su - &#123;&#123; oracinstall.orac_user &#125;&#125; -c &apos;&#123;&#123; oracinstall.orac_install_dir &#125;&#125;/database/runInstaller -silent -waitforcompletion -ignoreSysPrereqs -ignorePrereq -responseFile &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db11R23.rsp -invPtrLoc &#123;&#123; oracinstall.orac_base &#125;&#125;/oraInst.loc&apos;</span><br><span class="line">        - env: </span><br><span class="line">          - ORACLE_BASE: &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">          - ORACLE_HOME: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">          - PATH: &#123;&#123; oracinstall.orac_env_path &#125;&#125;</span><br><span class="line"></span><br><span class="line">#修改文件权限</span><br><span class="line">chmod_0644_comps_xml:</span><br><span class="line">    cmd.run:</span><br><span class="line">       - name: chmod 0644 &#123;&#123; oracinstall.orac_inventory &#125;&#125;/ContentsXML/comps.xml</span><br><span class="line">       - runas: root</span><br><span class="line">       - cwd:  &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line">       - only : stat &#123;&#123; oracinstall.orac_inventory &#125;&#125;/ContentsXML/comps.xml</span><br><span class="line">#修改文件权限</span><br><span class="line">chmod_0644_libss_xml:</span><br><span class="line">    cmd.run:</span><br><span class="line">       - name: chmod 0644 &#123;&#123; oracinstall.orac_inventory &#125;&#125;/ContentsXML/libs.xml</span><br><span class="line">       - runas: root</span><br><span class="line">       - cwd:  &#123;&#123; oracinstall.orac_install_dir &#125;&#125;</span><br><span class="line">       - only : stat &#123;&#123; oracinstall.orac_inventory &#125;&#125;/ContentsXML/libs.xml</span><br><span class="line">#执行&#123;&#123; oracinstall.orac_home &#125;&#125;/root.sh脚本</span><br><span class="line">&#123;&#123; oracinstall.orac_home &#125;&#125;/root.sh:</span><br><span class="line">    cmd.run</span><br><span class="line"></span><br><span class="line">#修改文件权限</span><br><span class="line">install sqlplus startup config file:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: |</span><br><span class="line">            chmod 0644 &#123;&#123; oracinstall.orac_home &#125;&#125;/sqlplus/admin/glogin.sql;</span><br><span class="line">            chown &#123;&#123; oracinstall.orac_user&#125;&#125;.oinstall &#123;&#123; oracinstall.orac_home &#125;&#125;/sqlplus/admin/glogin.sql;</span><br><span class="line"></span><br><span class="line">#同步/etc/init.d/oracle文件</span><br><span class="line">template &apos;/etc/init.d/oracle&apos;:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: /etc/init.d/oracle</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/ora_init_script</span><br><span class="line">        - mode: 0755</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">          orac_user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">          orac_home: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line"></span><br><span class="line">#添加oracle自启动</span><br><span class="line">enable oracle:</span><br><span class="line">    service.enabled:</span><br><span class="line">        - name: oracle</span><br></pre></td></tr></table></figure>
<h6 id="logrotate-alert-log-sls"><a href="#logrotate-alert-log-sls" class="headerlink" title="logrotate_alert_log.sls"></a>logrotate_alert_log.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat logrotate_alert_log.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line"># By default, this will rotate the alert_*.log files every week</span><br><span class="line"># and will store 10400 weeks&apos; worth of logs.</span><br><span class="line">template &quot;/etc/logrotate.d/oracle-alert-log&quot;:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: /etc/logrotate.d/oracle-alert-log</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/oracle-alert-log</span><br><span class="line">        - user: root</span><br><span class="line">        - group: root</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">           orac_base:  &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">           orac_home:  &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="logrotate-listener-sls"><a href="#logrotate-listener-sls" class="headerlink" title="logrotate_listener.sls"></a>logrotate_listener.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat logrotate_listener.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line"># By default, this will rotate the listener.log files every week</span><br><span class="line"># and will keep the rotated logs for 5 weeks.</span><br><span class="line">template &quot;/etc/logrotate.d/oracle-listener&quot;:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: /etc/logrotate.d/oracle-listener</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/oracle-listener</span><br><span class="line">        - user: root</span><br><span class="line">        - group: root</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">           orac_base:  &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">           orac_home:  &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="lsnrctl-sls"><a href="#lsnrctl-sls" class="headerlink" title="lsnrctl.sls"></a>lsnrctl.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat lsnrctl.sls</span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line">#静默建立监听</span><br><span class="line">slient lsnrctl:</span><br><span class="line">  cmd.run:</span><br><span class="line">    - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/bin/netca /silent /responsefile &#123;&#123;oracinstall.orac_install_dir&#125;&#125;/database/response/netca.rsp</span><br><span class="line"></span><br><span class="line">#停止监听</span><br><span class="line">stop lsnrctl:</span><br><span class="line">  cmd.run:</span><br><span class="line">    - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/bin/lsnrctl  stop</span><br><span class="line">    #- runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">    - env: </span><br><span class="line">        - ORACLE_BASE: &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">        - ORACLE_HOME: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">        - PATH: &#123;&#123; oracinstall.orac_env_path &#125;&#125;</span><br><span class="line">#通过监听文件listener.ora</span><br><span class="line">template &#123;&#123; oracinstall.orac_home &#125;&#125;/network/admin/listener.ora:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/network/admin/listener.ora</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/listener.ora</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">            ora_fqdn: &#123;&#123; oracinstall.orac_fqdn &#125;&#125;</span><br><span class="line">            orac_sid: &#123;&#123; oracinstall.orac_sid &#125;&#125;</span><br><span class="line">            orac_home: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">#通过监听文件tnsnames.ora</span><br><span class="line">template &#123;&#123; oracinstall.orac_home &#125;&#125;/network/admin/tnsnames.ora:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/network/admin/tnsnames.ora</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/tnsnames.ora</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">            ora_fqdn: &#123;&#123; oracinstall.orac_fqdn &#125;&#125;</span><br><span class="line">            orac_sid: &#123;&#123; oracinstall.orac_sid &#125;&#125;</span><br><span class="line">#启动监听</span><br><span class="line">start_listener:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: &quot;&#123;&#123; oracinstall.orac_home &#125;&#125;/bin/lsnrctl start&quot;</span><br><span class="line">     #   - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - env: </span><br><span class="line">           - ORACLE_BASE: &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">           - ORACLE_HOME: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">           - PATH: &#123;&#123; oracinstall.orac_env_path &#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="create-db-sls"><a href="#create-db-sls" class="headerlink" title="create_db.sls"></a>create_db.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat create_db.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line">#file.managed  文件同步 将templates目录下的dbca.rsp同步到minion上的&#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db_create.rsp</span><br><span class="line">#&#123;&#123; oracinstall.orac_install_dir &#125;&#125;是jinja模版的变量的语法，引用的是setting.sls</span><br><span class="line"></span><br><span class="line">template &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db_create.rsp:</span><br><span class="line">    file.managed:</span><br><span class="line">        - name: &#123;&#123; oracinstall.orac_install_dir &#125;&#125;/db_create.rsp</span><br><span class="line">        - source: salt://$&#123;instanceId?if_exists&#125;/templates/dbca.rsp</span><br><span class="line">        - user: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br><span class="line">        - group: oinstall</span><br><span class="line">        - mode: 0644</span><br><span class="line">        - template: jinja</span><br><span class="line">        - defaults:</span><br><span class="line">            ora_fqdn: &#123;&#123; oracinstall.orac_fqdn &#125;&#125;</span><br><span class="line">            orac_sid: &#123;&#123; oracinstall.orac_sid &#125;&#125;</span><br><span class="line">            orac_home: &#123;&#123; oracinstall.orac_home &#125;&#125;</span><br><span class="line">            orac_dbpw: &#123;&#123; oracinstall.orac_dbpw &#125;&#125;</span><br><span class="line">#cmd.run 执行cmd命令</span><br><span class="line">#修改&#123;&#123; oracinstall.orac_base &#125;&#125;/cfgtoollogs 的所属用户和组</span><br><span class="line">chown cfgtoollogs:</span><br><span class="line">    cmd.run:</span><br><span class="line">        - name: chown -R oracle:oinstall &#123;&#123; oracinstall.orac_base &#125;&#125;/cfgtoollogs</span><br><span class="line"></span><br><span class="line">#cmd.run 执行cmd命令</span><br><span class="line">#静默创建数据库</span><br><span class="line">slient lsnrctl:</span><br><span class="line">  cmd.run:</span><br><span class="line">    - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/bin/dbca -silent -responsefile &#123;&#123;oracinstall.orac_install_dir&#125;&#125;/db_create.rsp</span><br><span class="line">    - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="delete-db-sls"><a href="#delete-db-sls" class="headerlink" title="delete_db.sls"></a>delete_db.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat delete_db.sls </span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line"></span><br><span class="line">#执行命令 静默删除数据库</span><br><span class="line">delete db :</span><br><span class="line">  cmd.run:</span><br><span class="line">      - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/bin/dbca -silent -deleteDatabase -sourceDB &#123;&#123; oracinstall.orac_sid &#125;&#125; -sysDBAUserName sys -sysDBAPassword &#123;&#123; oracinstall.orac_dbpw  &#125;&#125;</span><br><span class="line">      - runas: &#123;&#123; oracinstall.orac_user &#125;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="destroy-sls"><a href="#destroy-sls" class="headerlink" title="destroy.sls"></a>destroy.sls</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat destroy.sls</span><br><span class="line">&#123;%- from &apos;$&#123;instanceId?if_exists&#125;/setting.sls&apos; import oracinstall with context -%&#125;</span><br><span class="line">#停止监听</span><br><span class="line">stop_lsnrctl:</span><br><span class="line">  cmd.run:</span><br><span class="line">    - name: &#123;&#123; oracinstall.orac_home &#125;&#125;/bin/lsnrctl  stop</span><br><span class="line">#删除文件</span><br><span class="line">remove_oracle:</span><br><span class="line">  file.absent:</span><br><span class="line">    - names:</span><br><span class="line">      - &#123;&#123; oracinstall.orac_base &#125;&#125;</span><br><span class="line">      - &#123;&#123; oracinstall.orac_inventory &#125;&#125;</span><br><span class="line">      - /opt/ORCLfmap</span><br><span class="line">      - /etc/oratab</span><br></pre></td></tr></table></figure>
<h6 id="oracle11g-sls"><a href="#oracle11g-sls" class="headerlink" title="oracle11g.sls"></a>oracle11g.sls</h6><p>此文件为oracle的pillar数据文件 文件目录为/srv/pillar/oracle11g.sls<br>通过saltconfig同步<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# cat oracle11g.sls </span><br><span class="line">orac_base: &apos;/opt/oracle11g&apos;</span><br><span class="line">orac_inventory: &apos;/opt/oraInventory&apos;</span><br><span class="line">orac_home: &apos;/opt/oracle11g/11R23&apos;</span><br><span class="line">orac_install_dir: &apos;/opt/oracle11g/install_dir&apos;</span><br><span class="line">orac_user: &apos;oracle&apos;</span><br><span class="line">orac_sid: &apos;ora&apos;</span><br><span class="line">orac_pw: &apos;passw0rd&apos;</span><br><span class="line">file_server: &apos;http://10.126.3.192&apos;</span><br><span class="line">oracle_deps_rpm_url: &apos;http://10.126.3.192/oracle11g/linux/&apos;</span><br><span class="line">oracle_deps_name: &apos;oracle11g_deps&apos;</span><br><span class="line">temp_path: &apos;/tmp/dcits&apos;</span><br><span class="line">orac_install_files:</span><br><span class="line">  - http://10.126.3.192/oracle11g/linux/linux.x64_11gR2_database_1of2.zip</span><br><span class="line">  - http://10.126.3.192/oracle11g/linux/linux.x64_11gR2_database_2of2.zip</span><br><span class="line">orac_user_id: 201</span><br><span class="line">orac_user_gid: 201</span><br><span class="line">orac_user_shell: &apos;/bin/bash&apos;</span><br><span class="line">orac_user_passwd: false</span><br><span class="line"></span><br><span class="line">orac_user_sup_grps:</span><br><span class="line">   dba: 202</span><br><span class="line">   bckpdba: 203</span><br><span class="line">   dgdba: 204</span><br><span class="line">   kmdba: 205   </span><br><span class="line"></span><br><span class="line">orac_rdbms_dbbin_version: &apos;11g&apos;</span><br><span class="line">orac_rdbms_is_installed: false</span><br><span class="line">orac_rdbms_install_info: &apos;&apos;</span><br><span class="line"></span><br><span class="line">#orac_rdbms_deps_rpm_local:</span><br><span class="line"></span><br><span class="line">oracle_sysctl:</span><br><span class="line">   fs.suid_dumpable: 1</span><br><span class="line">   fs.aio-max-nr: 1048576</span><br><span class="line">   fs.file-max: 6815744</span><br><span class="line">   kernel.shmall: 2097152</span><br><span class="line">   kernel.shmmax: 536870912</span><br><span class="line">   kernel.shmmni: 4096</span><br><span class="line">   kernel.sem: &apos;250 32000 100 128&apos;</span><br><span class="line">   net.ipv4.ip_local_port_range: &apos;9000 65500&apos;</span><br><span class="line">   net.core.rmem_default: 262144</span><br><span class="line">   net.core.rmem_max: 4194304</span><br><span class="line">   net.core.wmem_default: 262144</span><br><span class="line">   net.core.wmem_max: 1048586</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">oracinstall:</span><br><span class="line">    orac_fqdn: &apos;oracle&apos;</span><br><span class="line">    orac_user_gid: &apos;201&apos;</span><br><span class="line">    orac_user: &apos;oracle&apos;</span><br><span class="line">    orac_user_uid: &apos;201&apos;</span><br><span class="line">    orac_user_shell: &apos;/bin/bash&apos;</span><br><span class="line">    orac_user_sup_grps: &apos;&apos;</span><br><span class="line">    orac_pw: &apos;passw0rd&apos;</span><br><span class="line">    orac_home: &apos;/opt/oracle11g/11R23&apos;</span><br><span class="line">    orac_base: &apos;/opt/oracle11g&apos;</span><br><span class="line">    orac_sid: &apos;ora&apos;</span><br><span class="line">    oracle_deps_rpm_url: &apos;http://10.126.3.192/oracle11g/linux/&apos;</span><br><span class="line">    oracle_deps_name: &apos;oracle11g_deps&apos;</span><br><span class="line">    orac_env_path: &apos;&apos;</span><br><span class="line">    file_server_url: &apos;http://10.126.3.192&apos;</span><br><span class="line">    oracle_sysctl: &apos;&apos;</span><br><span class="line">    orac_install_dir: &apos;/opt/oracle11g/install_dir&apos;</span><br><span class="line">    orac_inventory: &apos;/opt/oraInventory&apos;</span><br><span class="line">    install_files: &apos;&apos;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/26/salt-usage-in-cd/" data-id="cjbne1zpy0001i8gi75c0inji" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/12/26/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/26/salt-usage-in-cd/">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/12/26/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>